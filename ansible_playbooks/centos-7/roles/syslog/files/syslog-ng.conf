@version:3.10
@include "scl.conf"

# syslog-ng configuration file.
#
# This should behave pretty much like the original syslog on RedHat. But
# it could be configured a lot smarter.
#
# See syslog-ng(8) and syslog-ng.conf(5) for more information.
#
# Note: it also sources additional configuration files (*.conf)
#       located in /etc/syslog-ng/conf.d/

options {
    flush_lines (0);
    time_reopen (10);
    log_fifo_size (1000);
    chain_hostnames (off);
    use_dns (no);
    use_fqdn (no);
    create_dirs (yes);
    keep_hostname (yes);
};

source s_sys {
    system();  # by default, from syslog-ng 3.6 on, this is journald
    internal();
    # udp(ip(0.0.0.0) port(514));
};

source s_suri {
    file("/var/log/suricata/eve.json"
    program-override("suricata")
    flags(no-parse));
};

destination d_mesg { file("/var/log/syslog-ng/messages.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );};
destination d_auth { file("/var/log/syslog-ng/secure.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );};
destination d_mail { file("/var/log/syslog-ng/maillog.json" flush_lines(10) template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );};
destination d_spol { file("/var/log/syslog-ng/spooler.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );};
destination d_boot { file("/var/log/syslog-ng/boot.log.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );};
destination d_cron { file("/var/log/syslog-ng/cron.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );};
destination d_kern { file("/var/log/syslog-ng/kern.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );};
destination d_mlal { file("/var/log/syslog-ng/emer.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );};
destination d_dock { file("/var/log/syslog-ng/dockerd.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );}; 
destination d_audt { file("/var/log/syslog-ng/auditd.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );}; 
destination d_fl2b { file("/var/log/syslog-ng/fail2ban.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );}; 
destination d_secr { file("/var/log/syslog-ng/security.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );}; 
destination d_sysl { file("/var/log/syslog-ng/syslog.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );}; 
destination d_suri { file("/var/log/syslog-ng/suricata.json" template("$(format_json --scope rfc5424 --key .journald.*)\n\n") );}; 


filter f_docker { program(dockerd) or match("docker"); };
filter f_auditd { program(auditd); };
filter f_suri { program(suricata); };
filter f_fail2ban { program(fail2ban-client); };
filter f_security { facility(security); };
filter f_syslog { facility(syslog); };     
filter f_kernel     { facility(kern); };
filter f_default    { level(info..emerg) and
                        not (facility(mail)
                        or facility(authpriv) 
                        or facility(cron)); };
filter f_auth       { facility(authpriv); };
filter f_mail       { facility(mail); };
filter f_emergency  { level(emerg); };
filter f_news       { facility(uucp) or
                        (facility(news) 
                        and level(crit..emerg)); };
filter f_boot   { facility(local7); };
filter f_cron   { facility(cron); };

log { source(s_sys); filter(f_kernel); destination(d_kern); };
log { source(s_sys); filter(f_default); destination(d_mesg); };
log { source(s_sys); filter(f_auth); destination(d_auth); };
log { source(s_sys); filter(f_mail); destination(d_mail); };
log { source(s_sys); filter(f_emergency); destination(d_mlal); };
log { source(s_sys); filter(f_news); destination(d_spol); };
log { source(s_sys); filter(f_boot); destination(d_boot); };
log { source(s_sys); filter(f_cron); destination(d_cron); };
log { source(s_sys); filter(f_docker); destination(d_dock); };
log { source(s_sys); filter(f_auditd); destination(d_audt); };
log { source(s_sys); filter(f_fail2ban); destination(d_fl2b); };
log { source(s_sys); filter(f_security); destination(d_secr); };
log { source(s_sys); filter(f_syslog); destination(d_sysl); };
log { source(s_suri); filter(f_suri); destination(d_suri); };

